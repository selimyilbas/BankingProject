<div class="transfer-container">
  <div class="transfer-header">
    <h2>Para Transferi</h2>
    <p>Hesaplarınız arasında güvenli transfer işlemi yapın</p>
  </div>

  <div class="transfer-form">
    <div class="form-group">
      <label for="fromAccount">Kaynak Hesap</label>
      <select 
        id="fromAccount" 
        [(ngModel)]="transferRequest.fromAccountId" (ngModelChange)="updatePreview()"
        class="form-control"
        [disabled]="loading">
        <option value="0">Hesap seçin</option>
        <option 
          *ngFor="let account of accounts" 
          [value]="account.accountId">
          {{ getAccountDisplayName(account) }}
        </option>
      </select>
    </div>

    <div class="form-group">
      <label for="toAccount">Hedef Hesap</label>
      <select 
        id="toAccount" 
        [(ngModel)]="transferRequest.toAccountId" (ngModelChange)="updatePreview()"
        class="form-control"
        [disabled]="loading">
        <option value="0">Hesap seçin</option>
        <option 
          *ngFor="let account of accounts" 
          [value]="account.accountId"
          [disabled]="account.accountId === transferRequest.fromAccountId">
          {{ getAccountDisplayName(account) }}
        </option>
      </select>
    </div>

    <div class="form-group">
      <label for="amount">Transfer Tutarı</label>
      <input 
        type="number" 
        id="amount"
        [(ngModel)]="transferRequest.amount" (ngModelChange)="updatePreview()"
        class="form-control"
        placeholder="0.00"
        min="0.01"
        step="0.01"
        [disabled]="loading">
    </div>

    <div class="form-group">
      <label for="description">Açıklama</label>
      <textarea 
        id="description"
        [(ngModel)]="transferRequest.description"
        class="form-control"
        placeholder="Transfer açıklaması (opsiyonel)"
        rows="3"
        [disabled]="loading"></textarea>
    </div>

    <!-- Transfer Preview -->
    <div *ngIf="getFromAccount() && getToAccount() && transferRequest.amount > 0" class="transfer-preview">
      <h4>Transfer Önizlemesi</h4>
      <div class="preview-item">
        <span>Kaynak:</span>
        <span>{{ getFromAccount()?.accountNumber }} ({{ getFromAccount()?.currency }})</span>
      </div>
      <div class="preview-item">
        <span>Hedef:</span>
        <span>{{ getToAccount()?.accountNumber }} ({{ getToAccount()?.currency }})</span>
      </div>
      <div class="preview-item">
        <span>Tutar:</span>
        <span>{{ transferRequest.amount | number:'1.2-2' }} {{ getFromAccount()?.currency }}</span>
      </div>
      <div class="preview-item" *ngIf="getFromAccount()?.currency !== getToAccount()?.currency">
    <span>Dönüşüm:</span>
    <span *ngIf="!conversionLoading && !conversionError">
      {{ transferRequest.amount | number:'1.2-2' }} {{ getFromAccount()?.currency }} ≈ {{ convertedAmount | number:'1.2-2' }} {{ getToAccount()?.currency }}
    </span>
    <span *ngIf="conversionLoading"><i class="fas fa-spinner fa-spin"></i> hesaplanıyor...</span>
    <span *ngIf="conversionError" class="text-danger">{{ conversionError }}</span>
  </div>
    </div>

    <!-- Messages -->
    <div *ngIf="successMessage" class="alert alert-success">
      {{ successMessage }}
    </div>
    <div *ngIf="errorMessage" class="alert alert-danger">
      {{ errorMessage }}
    </div>



    <!-- Action Buttons -->
    <div class="form-actions">
      <button 
        type="button" 
        class="btn btn-primary"
        (click)="createTransfer()"
        [disabled]="loading || !transferRequest.fromAccountId || !transferRequest.toAccountId || !transferRequest.amount">
        <span *ngIf="!loading">Transfer Yap</span>
        <span *ngIf="loading">
          <i class="fas fa-spinner fa-spin"></i> İşleniyor...
        </span>
      </button>
      
      <button 
        type="button" 
        class="btn btn-secondary"
        (click)="resetForm()"
        [disabled]="loading">
        Temizle
      </button>
    </div>
  </div>

  <!-- Account Balances -->
  <div class="account-balances">
    <h4>Hesap Bakiyeleri</h4>
    <div class="balance-cards">
      <div *ngFor="let account of accounts" class="balance-card">
        <div class="balance-header">
          <span class="account-number">{{ account.accountNumber }}</span>
          <span class="currency">{{ account.currency }}</span>
        </div>
        <div class="balance-amount">
          {{ account.balance | number:'1.2-2' }}
        </div>
      </div>
    </div>
  </div>
</div> 